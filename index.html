<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jessica & Christoph ‚Äì 20.06.2026</title>
  <style>
    body {
      background: #ffffff;
      color: #000;
      font-family: 'Georgia', serif;
      text-align: center;
      padding: 2rem;
      background-position: top center;
    }
    h1 {
      font-size: 2.5rem;
      color: #bfa34a;
      margin-bottom: 0.3rem;
      font-family: 'Georgia', serif;
    }
    h2 {
      font-size: 1.3rem;
      font-weight: normal;
      color: #bfa34a;
      margin-bottom: 1rem;
    }
    h3 {
      font-family: 'Georgia', serif;
      font-size: 1.2rem;
      color: #000;
    }
    select, button {
      font-size: 1rem;
      padding: 0.6rem 1.2rem;
      margin: 0.5rem;
      border-radius: 8px;
      border: none;
      background: #2a4d2a;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background: #1f3c1f;
    }
    video, img {
      display: block;
      margin: 1rem auto;
      max-width: 90vw;
      border: 2px solid #bfa34a;
      border-radius: 10px;
    }
    #message {
      margin-top: 1rem;
      font-weight: bold;
      color: #bfa34a;
    }
    footer {
      margin-top: 2rem;
      font-style: italic;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Jessica <span style="color: #000;">&</span> Christoph</h1>
  <h2>20.06.2026</h2>
  <h3>Teilt eure besonderen Momente mit uns!</h3>

  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
  <img id="photo" alt="Aufgenommenes Foto" />

  <div>
    <button id="frontBtn">Frontkamera</button>
    <button id="backBtn">R√ºckkamera</button>
  </div>

  <button id="takePhotoBtn">üì∏ Foto machen</button>
  <button id="uploadBtn" disabled>‚¨ÜÔ∏è Hochladen</button>

  <div id="message"></div>
  <footer>Danke f√ºrs Mitmachen!</footer>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const photo = document.getElementById('photo');
    const message = document.getElementById('message');

    let currentStream = null;
    let currentFacingMode = 'user';
    let capturedImageBlob = null;

    // --- Dropbox Credentials ---
    const DROPBOX_REFRESH_TOKEN = "hPbaMzF_PPwAAAAAAAAAAVLY0yJnsYxOoWH0RIuixW-19iztORTYQTyBbNSYZuj1";
    const DROPBOX_APP_KEY = "bqtnuo0pptbtwh2";
    const DROPBOX_APP_SECRET = "n5ftqwpsa0nz4mb";

    // --- Kamera starten ---
    async function startCamera(facingMode) {
      if (currentStream) currentStream.getTracks().forEach(track => track.stop());
      try {
        currentStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { exact: facingMode } },
          audio: false
        });
      } catch {
        currentStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode },
          audio: false
        });
      }
      video.srcObject = currentStream;
      currentFacingMode = facingMode;
      message.textContent='';
      document.getElementById('uploadBtn').disabled=true;
      photo.src=''; capturedImageBlob=null;
    }

    document.getElementById('frontBtn').addEventListener('click', () => startCamera('user'));
    document.getElementById('backBtn').addEventListener('click', () => startCamera('environment'));

    // --- Foto aufnehmen ---
    document.getElementById('takePhotoBtn').addEventListener('click', () => {
      if(!currentStream){ message.textContent='Bitte erst Kamera ausw√§hlen.'; return; }
      const w = video.videoWidth, h = video.videoHeight;
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      if(currentFacingMode==='user'){ ctx.translate(w,0); ctx.scale(-1,1); }
      ctx.drawImage(video,0,0,w,h); ctx.setTransform(1,0,0,1,0,0);
      canvas.toBlob(blob => {
        capturedImageBlob = blob;
        photo.src = URL.createObjectURL(blob);
        document.getElementById('uploadBtn').disabled=false;
        message.textContent='Foto aufgenommen. Jetzt Hochladen klicken.';
      }, 'image/jpeg', 0.95);
    });

    // --- Access Token vom Refresh Token ---
    async function getAccessToken(){
      const resp = await fetch("https://api.dropbox.com/oauth2/token",{
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body: new URLSearchParams({
          grant_type: "refresh_token",
          refresh_token: DROPBOX_REFRESH_TOKEN,
          client_id: DROPBOX_APP_KEY,
          client_secret: DROPBOX_APP_SECRET
        })
      });
      const data = await resp.json();
      if(!data.access_token) throw new Error("Kein Access Token erhalten");
      return data.access_token;
    }

    // --- Upload direkt zu Dropbox ---
    document.getElementById('uploadBtn').addEventListener('click', async () => {
      if(!capturedImageBlob){ message.textContent='Bitte erst ein Foto machen.'; return; }
      message.textContent='Lade Bild hoch...';
      try{
        const accessToken = await getAccessToken();
        const filename = `JessicaChristoph_${Date.now()}.jpg`;
        const resp = await fetch("https://content.dropboxapi.com/2/files/upload", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${accessToken}`,
            "Dropbox-API-Arg": JSON.stringify({ path: "/" + filename, mode:"add", autorename:true, mute:false }),
            "Content-Type": "application/octet-stream"
          },
          body: capturedImageBlob
        });
        const text = await resp.text();
        let result = {};
        try{ result = JSON.parse(text); } catch{}
        if(result.name){ message.style.color='#2a4d2a'; message.textContent='Bild erfolgreich hochgeladen!'; }
        else throw new Error(result.error_summary || "Unbekannter Fehler");
      }catch(err){ message.style.color='red'; message.textContent='Fehler beim Upload: '+err.message; }
    });

    startCamera('user');
  </script>
</body>
</html>

</body>
</html>
